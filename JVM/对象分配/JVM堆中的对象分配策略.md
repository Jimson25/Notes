## 一、对象分配策略

1. 随着JIT编译器的发展与逃逸分析技术的成熟，栈上分配和标量替换优化技术将会对对象的分配策略产生一些影响，所有对象都是分配在堆上就不是那么的绝对了。在虚拟机中存在一种特殊情况，如果`经过逃逸分析`后发现`一个对象并没有逃逸出方法`的话，那么`该对象就会被优化为栈上分配`，此时就不需要对该对象执行垃圾回收，对象的生命周期和方法绑定，当方法出栈时对象就消失。

2. 逃逸分析是一种可以有效减少java程序中的同步负载和内存堆分配压力的跨函数全局数据流分析算法。通过逃逸分析，HotSpot编译器能分析出一个对象引用的适用范围从而决定时候要将这个对象分配到堆上。

3. 逃逸分析的基本行为是分析一个对象的动态作用域：
    - 当一个对象在方法中被定义后，对象只在方法内部使用，那么就认为这个对象没有发生逃逸。
    - 当一个对象在方法中被定义后，它被外部方法所引用则认为该对象发生了逃逸。如将对象作为返回值返回、作为参数传递到其他方法中等。

4. 使用逃逸分析后，编译器可以对java代码进行如下优化：
    - 栈上分配：将对象的分配位置由堆区转换到栈区。
    - 同步省略：如果发现一个对象只能在一个线程中被访问，那么对于这个对象可以不用考虑同步操作。
    - 分离对象或标量替换：有的对象不需要作为一个连续的内存结构存在也可以被访问到，那么对象的部分（全部）可以不存储在内存中，而是存储在cpu寄存器中。

5. 在开发中，从节省内存和程序执行效率上考虑的话，能使用局部变量就不要在方法外定义成成员变量。