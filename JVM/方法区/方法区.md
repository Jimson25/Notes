## 虚拟机方法区

1. 方法区是一块独立于堆区的内存空间（非堆），在JDK7及以前叫永久代，在JDK8中改名为元数据区（Metaspace）。
    - 方法区在虚拟机启动时创建，它在实际物理内存中和堆区一样可以是不连续的内存空间。
    - 方法区是一块线程共享区域。
    - 方法区和堆区一样可以动态扩展其内存大小也可以设置固定值。在JDK8中，由于元数据区使用的是物理内存，所以理论上其大小是没有上限的，一般我们只调整其最小值而不用关注其最大值。
    - 方法区主要用于存放加载到系统的类数据，即方法区大小决定了系统可以加载多少个类，如果设置了其最大值并由此导致内存空间不足，就会报OOM异常。

2. 方法区参数设置
    - JDK7及以前： 
    - -XX:PermSize= 用于设置方法区初始值，如-XX:PermSize=100m 方法区默认大小为20.75m
    - -XX:MaxPermSize= 用于设置方法区最大值，如-XX:MaxPermSize=100m 

    -JDK8及以后：
    - -XX:MetaspaceSize= 用于设置方法区（元数据区）初始大小，如-XX:Metaspace=100m
    - -XX:MaxMetaspaceSize= 用于设置方法区最大值，这里一般我们不会设置这个参数而是不限制其最大内存。

3. 注意： 
    - 对于一个64位的jvm来说，方法区默认大小为21m。这是一个初始的高水位线，当方法区占用大小达到这个值后，会触发full GC并卸载掉没用的类（对应的类加载器不在存活）。然后这个高水位线会被重置，新的高水位线会根据释放的空间决定，如果释放的空间不足，那么在不触及到方法区最大空间大小的情况下会提高这个初始值，反之会降低这个值。

    - 在实际应用中，为了避免频繁的Full GC，建议将方法区初始值设置为一个较大的数值（-XX:MetaspaceSize=）。