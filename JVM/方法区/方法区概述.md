## 虚拟机方法区

1. 方法区是一块独立于堆区的内存空间（非堆），在JDK7及以前叫永久代，在JDK8中改名为元数据区（Metaspace）。
    - 方法区在虚拟机启动时创建，它在实际物理内存中和堆区一样可以是不连续的内存空间。
    - 方法区是一块线程共享区域。
    - 方法区和堆区一样可以动态扩展其内存大小也可以设置固定值。在JDK8中，由于元数据区使用的是物理内存，所以理论上其大小是没有上限的，一般我们只调整其最小值而不用关注其最大值。
    - 方法区主要用于存放加载到系统的类数据，即方法区大小决定了系统可以加载多少个类，如果设置了其最大值并由此导致内存空间不足，就会报OOM异常。

2. 方法区参数设置
    - JDK7及以前： 
    - -XX:PermSize= 用于设置方法区初始值，如-XX:PermSize=100m 方法区默认大小为20.75m
    - -XX:MaxPermSize= 用于设置方法区最大值，如-XX:MaxPermSize=100m 

    -JDK8及以后：
    - -XX:MetaspaceSize= 用于设置方法区（元数据区）初始大小，如-XX:Metaspace=100m
    - -XX:MaxMetaspaceSize= 用于设置方法区最大值，这里一般我们不会设置这个参数而是不限制其最大内存。

3. 注意： 
    - 对于一个64位的jvm来说，方法区默认大小为21m。这是一个初始的高水位线，当方法区占用大小达到这个值后，会触发full GC并卸载掉没用的类（对应的类加载器不在存活）。然后这个高水位线会被重置，新的高水位线会根据释放的空间决定，如果释放的空间不足，那么在不触及到方法区最大空间大小的情况下会提高这个初始值，反之会降低这个值。

    - 在实际应用中，为了避免频繁的Full GC，建议将方法区初始值设置为一个较大的数值（-XX:MetaspaceSize=）。

4. 字节码常量池-运行时常量池
    - 对一个完整的字节码类而言，除了包含字段、方法、接口及类的版本信息等信息外，还要包含一项常量池表（Constant Pool Table），包括对各种字面量、类型、属性、方法的符号引用。对一个常规的java类而言，把它编译成字节码并运行的话是需要很多个类的支持的，而如果把它用到的类都加入到编译后的字节码文件中的话就会导致字节码文件变得异常庞大，所以我们在字节码文件中创建一个常量表用于存放这些外部的引用，然后在类加载过程中（解析阶段）中将这些符号引用指向到运行时常量池中的具体的类型引用（符号引用转换为直接引用）
    - 在方法区内部包含了一个运行时常量池